html_code = '''<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸­å›½è·³æ£‹ - ç»ç’ƒå¼¹ç ç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            min-height: 100vh;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            color: white;
            padding: 15px;
            overflow-x: hidden;
        }

        h1 {
            margin-bottom: 15px;
            font-size: 2em;
            background: linear-gradient(45deg, #f59e0b 0%, #fbbf24 50%, #f59e0b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px rgba(245, 158, 11, 0.3);
            letter-spacing: 2px;
        }

        .game-panel {
            display: flex;
            gap: 20px;
            align-items: flex-start;
            margin-bottom: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .game-info {
            display: flex;
            flex-direction: column;
            gap: 12px;
            align-items: center;
        }

        .current-player {
            font-size: 1.1em;
            padding: 14px 28px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 30px;
            border: 2px solid;
            transition: all 0.3s;
            backdrop-filter: blur(12px);
            min-width: 180px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }

        .mode-selector {
            display: flex;
            gap: 8px;
            background: rgba(255,255,255,0.06);
            padding: 6px;
            border-radius: 25px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
        }

        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 500;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
            position: relative;
            overflow: hidden;
        }

        button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        button:hover::before {
            left: 100%;
        }

        button:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
        }

        button:active {
            transform: translateY(0) scale(0.98);
        }

        button.active {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4);
        }

        button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none;
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
        }

        #board {
            position: relative;
            background: 
                radial-gradient(ellipse at 30% 20%, rgba(139, 92, 43, 0.4) 0%, transparent 50%),
                radial-gradient(ellipse at 70% 80%, rgba(139, 92, 43, 0.3) 0%, transparent 50%),
                linear-gradient(165deg, #8b5a2b 0%, #6b4423 50%, #5d3a1a 100%);
            border-radius: 20px;
            box-shadow: 
                0 30px 60px rgba(0, 0, 0, 0.6),
                inset 0 1px 0 rgba(255,255,255,0.1),
                0 0 0 8px #4a3728;
            padding: 35px;
            user-select: none;
            border: 1px solid rgba(139, 92, 43, 0.5);
        }

        .hole {
            position: absolute;
            width: 18px;
            height: 18px;
            background: 
                radial-gradient(circle at 30% 30%, rgba(92, 64, 51, 0.8), rgba(45, 31, 22, 0.9));
            border-radius: 50%;
            box-shadow: 
                inset 2px 2px 4px rgba(0, 0, 0, 0.9), 
                inset -1px -1px 2px rgba(255, 255, 255, 0.05),
                0 2px 4px rgba(0, 0, 0, 0.4);
            cursor: pointer;
            transition: all 0.2s;
            z-index: 10;
        }

        .hole:hover {
            box-shadow: 
                inset 2px 2px 4px rgba(0, 0, 0, 0.8), 
                0 0 20px rgba(255, 255, 255, 0.3);
            transform: scale(1.15);
        }

        .hole.valid-move {
            background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.95), rgba(200, 200, 200, 0.8));
            box-shadow: 
                0 0 20px rgba(255, 255, 255, 0.6), 
                inset 0 0 10px rgba(255, 255, 255, 0.4),
                0 0 40px rgba(255, 255, 255, 0.3);
            animation: pulse-glow 2s infinite;
            z-index: 15;
            border: 2px solid rgba(255, 255, 255, 0.8);
        }

        .hole.jump-move {
            background: radial-gradient(circle at 30% 30%, rgba(147, 197, 253, 0.95), rgba(96, 165, 250, 0.9));
            box-shadow: 
                0 0 25px rgba(59, 130, 246, 0.8), 
                inset 0 0 12px rgba(147, 197, 253, 0.6),
                0 0 50px rgba(59, 130, 246, 0.5);
            animation: pulse-blue 1.5s infinite;
            border: 2px solid rgba(147, 197, 253, 0.9);
            z-index: 16;
        }

        .hole.jump-continue {
            background: radial-gradient(circle at 30% 30%, rgba(251, 191, 36, 0.95), rgba(245, 158, 11, 0.9));
            box-shadow: 
                0 0 25px rgba(251, 191, 36, 0.8), 
                inset 0 0 12px rgba(251, 191, 36, 0.6),
                0 0 50px rgba(251, 191, 36, 0.5);
            animation: pulse-gold 1s infinite;
            border: 2px solid rgba(251, 191, 36, 0.9);
            z-index: 17;
        }

        @keyframes pulse-glow {
            0%, 100% { transform: scale(1); opacity: 0.9; box-shadow: 0 0 20px rgba(255,255,255,0.6); }
            50% { transform: scale(1.2); opacity: 0.7; box-shadow: 0 0 30px rgba(255,255,255,0.8); }
        }

        @keyframes pulse-blue {
            0%, 100% { transform: scale(1); opacity: 0.9; }
            50% { transform: scale(1.25); opacity: 0.75; }
        }

        @keyframes pulse-gold {
            0%, 100% { transform: scale(1); opacity: 0.95; }
            50% { transform: scale(1.3); opacity: 0.8; }
        }

        .piece {
            position: absolute;
            width: 26px;
            height: 26px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 20;
            pointer-events: auto;
            border: 1px solid rgba(255, 255, 255, 0.6);
            background: 
                radial-gradient(circle at 25% 25%, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.3) 20%, transparent 50%),
                radial-gradient(circle at 75% 75%, rgba(0,0,0,0.2) 0%, transparent 40%);
            box-shadow: 
                inset 2px 2px 4px rgba(255,255,255,0.5),
                inset -2px -2px 4px rgba(0,0,0,0.3),
                0 4px 8px rgba(0,0,0,0.4),
                0 0 15px currentColor;
        }

        .piece:hover {
            transform: scale(1.15);
            z-index: 30;
            filter: brightness(1.2);
            box-shadow: 
                inset 2px 2px 6px rgba(255,255,255,0.7),
                inset -2px -2px 6px rgba(0,0,0,0.4),
                0 6px 20px rgba(0,0,0,0.5),
                0 0 30px currentColor;
        }

        .piece.selected {
            animation: selected-glow 1.5s ease-in-out infinite alternate;
            transform: scale(1.2);
            z-index: 40;
            box-shadow: 
                inset 2px 2px 6px rgba(255,255,255,0.9),
                inset -2px -2px 6px rgba(0,0,0,0.5),
                0 0 30px currentColor,
                0 0 60px currentColor;
        }

        @keyframes selected-glow {
            from { box-shadow: inset 2px 2px 6px rgba(255,255,255,0.7), 0 0 20px currentColor, 0 0 40px currentColor; }
            to { box-shadow: inset 2px 2px 8px rgba(255,255,255,0.9), 0 0 40px currentColor, 0 0 80px rgba(255,255,255,0.6); }
        }

        /* ç»ç’ƒå¼¹ç é¢œè‰² - æ›´é²œè‰³çš„é…è‰² */
        .piece.player-0 { 
            background-color: #ef4444;
            color: rgba(239, 68, 68, 0.8);
        }
        .piece.player-1 { 
            background-color: #3b82f6;
            color: rgba(59, 130, 246, 0.8);
        }
        .piece.player-2 { 
            background-color: #22c55e;
            color: rgba(34, 197, 94, 0.8);
        }
        .piece.player-3 { 
            background-color: #eab308;
            color: rgba(234, 179, 8, 0.8);
        }
        .piece.player-4 { 
            background-color: #a855f7;
            color: rgba(168, 85, 247, 0.8);
        }
        .piece.player-5 { 
            background-color: #06b6d4;
            color: rgba(6, 182, 212, 0.8);
        }

        @keyframes marble-drop {
            0% { transform: translateY(-80px) scale(0.3); opacity: 0; }
            60% { transform: translateY(10px) scale(1.1); opacity: 1; }
            80% { transform: translateY(-5px) scale(0.95); }
            100% { transform: translateY(0) scale(1); opacity: 1; }
        }

        .instructions {
            margin-top: 20px;
            max-width: 700px;
            text-align: center;
            line-height: 1.8;
            background: rgba(255, 255, 255, 0.05);
            padding: 20px 25px;
            border-radius: 16px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            font-size: 0.95em;
        }

        .instructions strong {
            color: #fbbf24;
        }

        .win-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            padding: 50px 60px;
            border-radius: 24px;
            box-shadow: 
                0 25px 80px rgba(0, 0, 0, 0.8),
                0 0 0 1px rgba(255,255,255,0.1),
                inset 0 1px 0 rgba(255,255,255,0.1);
            z-index: 1000;
            text-align: center;
            display: none;
            border: 2px solid rgba(251, 191, 36, 0.5);
            animation: modal-in 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        @keyframes modal-in {
            to { transform: translate(-50%, -50%) scale(1); }
        }

        .win-message h2 {
            font-size: 2.8em;
            margin-bottom: 15px;
            background: linear-gradient(45deg, #fbbf24, #f59e0b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(251, 191, 36, 0.3);
        }

        .last-move {
            position: absolute;
            width: 32px;
            height: 32px;
            border: 3px solid rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            pointer-events: none;
            animation: fade-ring 2s forwards;
            z-index: 5;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.6);
        }

        @keyframes fade-ring {
            0%, 50% { opacity: 1; transform: scale(1); border-width: 3px; }
            100% { opacity: 0; transform: scale(1.8); border-width: 0px; }
        }

        .player-indicator {
            display: inline-block;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            margin-right: 10px;
            vertical-align: middle;
            box-shadow: 0 0 12px currentColor;
            border: 2px solid rgba(255,255,255,0.8);
        }

        .move-path {
            position: absolute;
            pointer-events: none;
            z-index: 18;
        }

        .move-info-panel {
            background: rgba(15, 23, 42, 0.8);
            border-radius: 12px;
            padding: 12px 20px;
            min-width: 220px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
        }

        .move-status {
            font-size: 0.9em;
            color: #94a3b8;
            margin-bottom: 6px;
        }

        .move-detail {
            font-size: 1.1em;
            font-weight: 600;
            color: white;
        }

        .jump-badge {
            display: inline-block;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            margin-left: 8px;
            font-weight: 700;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            margin-top: 6px;
            font-weight: 600;
        }

        .status-badge.continue {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
            border: 1px solid rgba(251, 191, 36, 0.4);
            animation: pulse-text 1.5s infinite;
        }

        @keyframes pulse-text {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .hint-text {
            color: #60a5fa;
        }

        .players-legend {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 10px;
            font-size: 0.85em;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
        }

        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 1px solid rgba(255,255,255,0.5);
        }
    </style>
</head>
<body>
    <h1>ğŸ”® ç»ç’ƒå¼¹ç è·³æ£‹</h1>
    
    <div class="game-panel">
        <div class="game-info">
            <div class="current-player" id="currentPlayer">
                <span class="player-indicator" id="playerIndicator"></span>
                <span id="playerText">çº¢æ–¹å›åˆ</span>
            </div>
            
            <div class="mode-selector">
                <button onclick="game.setMode(2)" id="mode2">2äºº</button>
                <button onclick="game.setMode(4)" id="mode4">4äºº</button>
                <button onclick="game.setMode(6)" id="mode6" class="active">6äºº</button>
            </div>
            
            <div class="controls">
                <button onclick="game.reset()">ğŸ”„ é‡æ–°å¼€å§‹</button>
                <button onclick="game.undo()" id="undoBtn" disabled>â†©ï¸ æ’¤é”€</button>
                <button onclick="game.toggleMoveHint()" id="hintBtn">ğŸ’¡ éšè—æç¤º</button>
            </div>
        </div>
        
        <div class="move-info-panel">
            <div class="move-status">å½“å‰çŠ¶æ€</div>
            <div class="move-detail" id="moveDetail">é€‰æ‹©æ£‹å­å¼€å§‹æ¸¸æˆ</div>
            <div class="status-badge" id="statusBadge" style="display: none;"></div>
        </div>
    </div>

    <div id="board"></div>

    <div class="instructions">
        <p>ğŸ® <strong>æ¸¸æˆæ“ä½œï¼š</strong>ç‚¹å‡»å·±æ–¹æ£‹å­é€‰ä¸­ï¼Œ<span class="hint-text">ç™½è‰²é«˜äº®</span>ä¸ºå•æ­¥ç§»åŠ¨ï¼Œ<span style="color: #60a5fa;">è“è‰²é«˜äº®</span>ä¸ºè·³è·ƒï¼Œ<span style="color: #fbbf24;">é‡‘è‰²é«˜äº®</span>è¡¨ç¤ºå¯ç»§ç»­è¿è·³</p>
        <p>ğŸš€ <strong>è¿è·³è§„åˆ™ï¼š</strong>è·³è·ƒåå¯ç»§ç»­å¯»æ‰¾è·³è·ƒæœºä¼šï¼Œç‚¹å‡»"ç»“æŸå›åˆ"æŒ‰é’®æˆ–æŒ‰ç©ºæ ¼é”®ç»“æŸè¿è·³</p>
        <p>ğŸ† <strong>èƒœåˆ©æ¡ä»¶ï¼š</strong>æœ€å…ˆå°†æ‰€æœ‰æ£‹å­ç§»åŠ¨åˆ°å¯¹è§’åŒºåŸŸè€…è·èƒœ</p>
        <div class="players-legend" id="playersLegend"></div>
    </div>

    <div class="win-message" id="winMessage">
        <h2>ğŸ‰ æ­å–œè·èƒœï¼</h2>
        <p id="winnerText"></p>
        <button onclick="game.reset()" style="margin-top: 20px; padding: 14px 35px; font-size: 1.1em;">å†æ¥ä¸€å±€</button>
    </div>

    <script>
        class ChineseCheckers {
            constructor() {
                this.board = document.getElementById('board');
                this.playerCount = 6;
                this.currentPlayer = 0;
                this.selectedPiece = null;
                this.validMoves = [];
                this.moveHistory = [];
                this.pieces = [];
                this.holes = [];
                this.boardState = new Map();
                this.showMoveHint = true;
                this.isMoving = false;
                
                // è¿è·³çŠ¶æ€è¿½è¸ª
                this.isInJumpChain = false;
                this.jumpChainCount = 0;
                this.originalPiece = null;
                this.jumpStartPosition = null;
                
                this.playerColors = ['çº¢', 'è“', 'ç»¿', 'é»„', 'ç´«', 'é’'];
                this.colorCodes = ['#ef4444', '#3b82f6', '#22c55e', '#eab308', '#a855f7', '#06b6d4'];
                this.colorNames = ['çº¢è‰²', 'è“è‰²', 'ç»¿è‰²', 'é»„è‰²', 'ç´«è‰²', 'é’è‰²'];
                
                this.rowCounts = [1, 2, 3, 4, 13, 12, 11, 10, 9, 10, 11, 12, 13, 4, 3, 2, 1];
                this.totalRows = 17;
                
                this.init();
                this.setupKeyboardControls();
            }

            setupKeyboardControls() {
                document.addEventListener('keydown', (e) => {
                    if (e.code === 'Space') {
                        e.preventDefault();
                        if (this.isInJumpChain) {
                            this.endJumpChain();
                        }
                    }
                    if (e.code === 'Escape') {
                        if (this.selectedPiece && !this.isInJumpChain) {
                            this.deselect();
                        }
                    }
                });
            }

            setMode(count) {
                this.playerCount = count;
                document.querySelectorAll('.mode-selector button').forEach(btn => btn.classList.remove('active'));
                document.getElementById(`mode${count}`).classList.add('active');
                this.updatePlayersLegend();
                this.reset();
            }

            getPlayOrder() {
                if (this.playerCount === 2) return [0, 1];
                if (this.playerCount === 4) return [0, 1, 2, 5];
                return [0, 1, 2, 3, 4, 5];
            }

            getActivePlayers() {
                return this.getPlayOrder();
            }

            updatePlayersLegend() {
                const container = document.getElementById('playersLegend');
                const players = this.getActivePlayers();
                container.innerHTML = players.map(p => 
                    `<div class="legend-item">
                        <div class="legend-dot" style="background: ${this.colorCodes[p]}; box-shadow: 0 0 8px ${this.colorCodes[p]}"></div>
                        <span>${this.playerColors[p]}æ–¹</span>
                    </div>`
                ).join(' â†’ ');
            }

            toggleMoveHint() {
                this.showMoveHint = !this.showMoveHint;
                const btn = document.getElementById('hintBtn');
                btn.textContent = this.showMoveHint ? 'ğŸ’¡ éšè—æç¤º' : 'ğŸ’¡ æ˜¾ç¤ºæç¤º';
                
                if (!this.showMoveHint) {
                    this.clearHighlights();
                } else if (this.selectedPiece) {
                    this.highlightValidMoves();
                }
            }

            clearHighlights() {
                document.querySelectorAll('.hole.valid-move, .hole.jump-move, .hole.jump-continue').forEach(h => {
                    h.classList.remove('valid-move', 'jump-move', 'jump-continue');
                });
            }

            init() {
                this.calculatePositions();
                this.createBoard();
                this.updatePlayersLegend();
                this.setupPieces();
                this.updatePlayerDisplay();
            }

            calculatePositions() {
                this.positions = [];
                const spacingX = 30;
                const spacingY = 26;
                const centerX = 300;
                
                for (let row = 0; row < this.totalRows; row++) {
                    const count = this.rowCounts[row];
                    const rowPositions = [];
                    const rowWidth = (count - 1) * spacingX;
                    const startX = centerX - rowWidth / 2;
                    
                    for (let col = 0; col < count; col++) {
                        rowPositions.push({
                            x: startX + col * spacingX,
                            y: 500 - row * spacingY,
                            row: row,
                            col: col,
                            id: `${row}-${col}`
                        });
                    }
                    this.positions.push(rowPositions);
                }
            }

            createBoard() {
                this.board.innerHTML = '';
                this.board.style.width = '600px';
                this.board.style.height = '540px';
                
                for (let row = 0; row < this.totalRows; row++) {
                    for (let pos of this.positions[row]) {
                        const hole = document.createElement('div');
                        hole.className = 'hole';
                        hole.style.left = (pos.x - 9) + 'px';
                        hole.style.top = (pos.y - 9) + 'px';
                        hole.dataset.row = row;
                        hole.dataset.col = pos.col;
                        
                        hole.addEventListener('click', (e) => {
                            e.stopPropagation();
                            this.onHoleClick(pos);
                        });
                        
                        this.board.appendChild(hole);
                        this.holes.push(hole);
                    }
                }
            }

            setupPieces() {
                document.querySelectorAll('.piece').forEach(p => p.remove());
                this.pieces = [];
                this.boardState.clear();
                this.isInJumpChain = false;
                this.jumpChainCount = 0;
                
                const activePlayers = this.getActivePlayers();
                const allCornerPositions = this.getAllCornerPositions();
                
                for (let player of activePlayers) {
                    const positions = allCornerPositions[player];
                    for (let pos of positions) {
                        if (this.isValidPosition(pos.row, pos.col)) {
                            this.createPiece(player, pos);
                        }
                    }
                }
            }

            getAllCornerPositions() {
                return [
                    // ç©å®¶0ï¼ˆçº¢ï¼‰- æ­£ä¸‹æ–¹
                    [{row: 16, col: 0}, {row: 15, col: 0}, {row: 15, col: 1}, {row: 14, col: 0}, {row: 14, col: 1}, {row: 14, col: 2}, {row: 13, col: 0}, {row: 13, col: 1}, {row: 13, col: 2}, {row: 13, col: 3}],
                    // ç©å®¶1ï¼ˆè“ï¼‰- æ­£ä¸Šæ–¹
                    [{row: 0, col: 0}, {row: 1, col: 0}, {row: 1, col: 1}, {row: 2, col: 0}, {row: 2, col: 1}, {row: 2, col: 2}, {row: 3, col: 0}, {row: 3, col: 1}, {row: 3, col: 2}, {row: 3, col: 3}],
                    // ç©å®¶2ï¼ˆç»¿ï¼‰- å·¦ä¸Šæ–¹
                    [{row: 4, col: 0}, {row: 4, col: 1}, {row: 5, col: 0}, {row: 4, col: 2}, {row: 5, col: 1}, {row: 6, col: 0}, {row: 4, col: 3}, {row: 5, col: 2}, {row: 6, col: 1}, {row: 7, col: 0}],
                    // ç©å®¶3ï¼ˆé»„ï¼‰- å³ä¸Šæ–¹
                    [{row: 4, col: 12}, {row: 4, col: 11}, {row: 5, col: 11}, {row: 4, col: 10}, {row: 5, col: 10}, {row: 6, col: 10}, {row: 4, col: 9}, {row: 5, col: 9}, {row: 6, col: 9}, {row: 7, col: 9}],
                    // ç©å®¶4ï¼ˆç´«ï¼‰- å·¦ä¸‹æ–¹
                    [{row: 12, col: 0}, {row: 11, col: 0}, {row: 12, col: 1}, {row: 10, col: 0}, {row: 11, col: 1}, {row: 12, col: 2}, {row: 9, col: 0}, {row: 10, col: 1}, {row: 11, col: 2}, {row: 12, col: 3}],
                    // ç©å®¶5ï¼ˆé’ï¼‰- å³ä¸‹æ–¹
                    [{row: 12, col: 12}, {row: 11, col: 11}, {row: 12, col: 11}, {row: 10, col: 10}, {row: 11, col: 10}, {row: 12, col: 10}, {row: 9, col: 9}, {row: 10, col: 9}, {row: 11, col: 9}, {row: 12, col: 9}]
                ];
            }

            isValidPosition(row, col) {
                return row >= 0 && row < this.totalRows && col >= 0 && col < this.rowCounts[row];
            }

            createPiece(player, pos) {
                const piece = document.createElement('div');
                piece.className = `piece player-${player}`;
                const position = this.positions[pos.row][pos.col];
                
                piece.style.left = (position.x - 13) + 'px';
                piece.style.top = (position.y - 13) + 'px';
                piece.dataset.player = player;
                piece.dataset.row = pos.row;
                piece.dataset.col = pos.col;
                
                piece.style.animation = 'marble-drop 0.6s cubic-bezier(0.34, 1.56, 0.64, 1)';
                setTimeout(() => piece.style.animation = '', 600);
                
                piece.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    const currentPos = {
                        row: parseInt(piece.dataset.row),
                        col: parseInt(piece.dataset.col)
                    };
                    this.onPieceClick(piece, currentPos);
                });
                
                this.board.appendChild(piece);
                this.pieces.push({element: piece, player: player, pos: pos});
                this.boardState.set(`${pos.row}-${pos.col}`, player);
            }

            onPieceClick(pieceElement, pos) {
                if (this.isMoving) return;
                
                const player = parseInt(pieceElement.dataset.player);
                
                // åœ¨è¿è·³è¿‡ç¨‹ä¸­ï¼Œåªèƒ½ç»§ç»­ç§»åŠ¨å½“å‰æ­£åœ¨è¿è·³çš„æ£‹å­
                if (this.isInJumpChain) {
                    if (pieceElement !== this.selectedPiece) {
                        this.showMessage('è¿è·³ä¸­ï¼Œè¯·ç»§ç»­ç§»åŠ¨å½“å‰æ£‹å­æˆ–æŒ‰ç©ºæ ¼ç»“æŸå›åˆ');
                        return;
                    }
                } else {
                    if (player !== this.currentPlayer) {
                        this.shakeElement(pieceElement);
                        return;
                    }
                }
                
                if (this.selectedPiece === pieceElement) {
                    // å¦‚æœæ˜¯è¿è·³çŠ¶æ€ï¼Œä¸å…è®¸å–æ¶ˆé€‰æ‹©ï¼Œå¿…é¡»å…ˆç»“æŸå›åˆ
                    if (this.isInJumpChain) {
                        this.showMessage('æ­£åœ¨è¿›è¡Œè¿è·³ï¼Œè¯·ç‚¹å‡»"ç»“æŸå›åˆ"æŒ‰é’®æˆ–æŒ‰ç©ºæ ¼é”®ç»“æŸ');
                        return;
                    }
                    this.deselect();
                    return;
                }
                
                this.deselect();
                this.selectedPiece = pieceElement;
                pieceElement.classList.add('selected');
                
                // è®¡ç®—ç§»åŠ¨ï¼šå¦‚æœæ˜¯è¿è·³ï¼Œåªè®¡ç®—è·³è·ƒç§»åŠ¨
                if (this.isInJumpChain) {
                    this.validMoves = this.calculateJumpOnlyMoves(pos);
                } else {
                    this.validMoves = this.calculateValidMoves(pos);
                }
                
                this.updateMoveInfo();
                
                if (this.showMoveHint) {
                    this.highlightValidMoves();
                }
            }

            // ä»…è®¡ç®—è·³è·ƒç§»åŠ¨ï¼ˆç”¨äºè¿è·³é˜¶æ®µï¼‰
            calculateJumpOnlyMoves(startPos) {
                const moves = [];
                const visited = new Set();
                const queue = [{pos: startPos, path: [startPos], jumpCount: 0}];
                visited.add(`${startPos.row}-${startPos.col}`);
                
                const directions = [[-1, -1], [-1, 0], [0, -1], [0, 1], [1, -1], [1, 0]];
                
                while (queue.length > 0) {
                    const {pos, path, jumpCount} = queue.shift();
                    
                    for (let [dr, dc] of directions) {
                        const adjRow = pos.row + dr;
                        const adjCol = pos.col + dc;
                        
                        if (!this.isValidPosition(adjRow, adjCol)) continue;
                        if (!this.boardState.has(`${adjRow}-${adjCol}`)) continue;
                        
                        const jumpRow = adjRow + dr;
                        const jumpCol = adjCol + dc;
                        
                        if (!this.isValidPosition(jumpRow, jumpCol)) continue;
                        if (this.boardState.has(`${jumpRow}-${jumpCol}`)) continue;
                        
                        // æ£€æŸ¥æ˜¯å¦å›åˆ°è¿è·³èµ·ç‚¹ï¼ˆç¦æ­¢ï¼‰
                        if (jumpRow === this.jumpStartPosition.row && jumpCol === this.jumpStartPosition.col) continue;
                        
                        const stateKey = `${jumpRow}-${jumpCol}-${path.length}`;
                        if (visited.has(stateKey)) continue;
                        visited.add(stateKey);
                        
                        const newPath = [...path, {row: jumpRow, col: jumpCol}];
                        const newJumpCount = jumpCount + 1;
                        
                        moves.push({
                            row: jumpRow,
                            col: jumpCol,
                            isJump: true,
                            jumpCount: newJumpCount,
                            path: newPath,
                            canContinue: true
                        });
                        
                        // ç»§ç»­æœç´¢æ›´æ·±å±‚çš„è·³è·ƒ
                        queue.push({
                            pos: {row: jumpRow, col: jumpCol},
                            path: newPath,
                            jumpCount: newJumpCount
                        });
                    }
                }
                
                return moves;
            }

            calculateValidMoves(startPos) {
                const moves = [];
                const visited = new Set();
                const queue = [{pos: startPos, path: [startPos], isJump: false, jumpCount: 0}];
                
                const directions = [[-1, -1], [-1, 0], [0, -1], [0, 1], [1, -1], [1, 0]];
                
                // ç¬¬ä¸€æ­¥ï¼šæ”¶é›†æ‰€æœ‰å•æ­¥ç§»åŠ¨
                for (let [dr, dc] of directions) {
                    const adjRow = startPos.row + dr;
                    const adjCol = startPos.col + dc;
                    
                    if (this.isValidPosition(adjRow, adjCol) && !this.boardState.has(`${adjRow}-${adjCol}`)) {
                        moves.push({
                            row: adjRow,
                            col: adjCol,
                            isJump: false,
                            jumpCount: 0,
                            path: [startPos, {row: adjRow, col: adjCol}],
                            canContinue: false
                        });
                    }
                }
                
                // BFSæœç´¢æ‰€æœ‰è·³è·ƒè·¯å¾„
                visited.add(`${startPos.row}-${startPos.col}`);
                
                while (queue.length > 0) {
                    const {pos, path, isJump, jumpCount} = queue.shift();
                    
                    for (let [dr, dc] of directions) {
                        const adjRow = pos.row + dr;
                        const adjCol = pos.col + dc;
                        
                        if (!this.isValidPosition(adjRow, adjCol)) continue;
                        if (!this.boardState.has(`${adjRow}-${adjCol}`)) continue;
                        
                        const jumpRow = adjRow + dr;
                        const jumpCol = adjCol + dc;
                        
                        if (!this.isValidPosition(jumpRow, jumpCol)) continue;
                        if (this.boardState.has(`${jumpRow}-${jumpCol}`)) continue;
                        
                        const stateKey = `${jumpRow}-${jumpCol}`;
                        if (visited.has(stateKey)) continue;
                        visited.add(stateKey);
                        
                        const newPath = [...path, {row: jumpRow, col: jumpCol}];
                        const newJumpCount = jumpCount + 1;
                        
                        moves.push({
                            row: jumpRow,
                            col: jumpCol,
                            isJump: true,
                            jumpCount: newJumpCount,
                            path: newPath,
                            canContinue: true
                        });
                        
                        queue.push({
                            pos: {row: jumpRow, col: jumpCol},
                            path: newPath,
                            isJump: true,
                            jumpCount: newJumpCount
                        });
                    }
                }
                
                return moves.filter(m => !(m.row === startPos.row && m.col === startPos.col));
            }

            highlightValidMoves() {
                this.clearHighlights();
                
                this.validMoves.forEach(move => {
                    const hole = this.findHole(move.row, move.col);
                    if (hole) {
                        if (this.isInJumpChain) {
                            // è¿è·³é˜¶æ®µï¼šé‡‘è‰²é«˜äº®æ‰€æœ‰å¯ç»§ç»­è·³è·ƒçš„ä½ç½®
                            hole.classList.add('jump-continue');
                        } else {
                            if (move.isJump) {
                                hole.classList.add('jump-move');
                            } else {
                                hole.classList.add('valid-move');
                            }
                        }
                    }
                });
            }

            updateMoveInfo() {
                const moveDetail = document.getElementById('moveDetail');
                const statusBadge = document.getElementById('statusBadge');
                
                if (this.isInJumpChain) {
                    if (this.validMoves.length > 0) {
                        moveDetail.innerHTML = `è¿è·³è¿›è¡Œä¸­ï¼å·²è·³ <span class="jump-badge">${this.jumpChainCount}</span> æ¬¡`;
                        statusBadge.textContent = 'ğŸ¯ å¯ç»§ç»­è·³è·ƒï¼ˆæŒ‰ç©ºæ ¼ç»“æŸï¼‰';
                        statusBadge.className = 'status-badge continue';
                        statusBadge.style.display = 'inline-block';
                    } else {
                        moveDetail.innerHTML = `è¿è·³ç»“æŸï¼å…±è·³ <span class="jump-badge">${this.jumpChainCount}</span> æ¬¡`;
                        statusBadge.textContent = 'â¹ï¸ æ— å¯ç”¨è·³è·ƒï¼Œå›åˆç»“æŸ';
                        statusBadge.className = 'status-badge';
                        statusBadge.style.display = 'inline-block';
                        statusBadge.style.background = 'rgba(107, 114, 128, 0.3)';
                        statusBadge.style.color = '#9ca3af';
                        
                        // è‡ªåŠ¨ç»“æŸå›åˆ
                        setTimeout(() => this.endJumpChain(), 1500);
                    }
                    return;
                }
                
                if (!this.selectedPiece) {
                    moveDetail.textContent = 'é€‰æ‹©æ£‹å­æŸ¥çœ‹å¯ç§»åŠ¨ä½ç½®';
                    statusBadge.style.display = 'none';
                    return;
                }
                
                if (this.validMoves.length === 0) {
                    moveDetail.textContent = 'è¯¥æ£‹å­æ— æ³•ç§»åŠ¨';
                    statusBadge.style.display = 'none';
                    return;
                }
                
                const jumpMoves = this.validMoves.filter(m => m.isJump);
                const normalMoves = this.validMoves.filter(m => !m.isJump);
                
                if (jumpMoves.length > 0) {
                    const maxJumps = Math.max(...jumpMoves.map(m => m.jumpCount));
                    moveDetail.innerHTML = `å¯${normalMoves.length > 0 ? 'ç§»åŠ¨æˆ–' : ''}è·³è·ƒ <span class="jump-badge">æœ€å¤š${maxJumps}è·³</span>`;
                    statusBadge.textContent = 'ğŸ’¡ ç‚¹å‡»è·³è·ƒå¼€å§‹è¿è·³';
                    statusBadge.className = 'status-badge';
                    statusBadge.style.display = 'inline-block';
                    statusBadge.style.background = 'rgba(59, 130, 246, 0.2)';
                    statusBadge.style.color = '#60a5fa';
                } else {
                    moveDetail.textContent = `å¯ç§»åŠ¨è‡³ ${normalMoves.length} ä¸ªç›¸é‚»ä½ç½®`;
                    statusBadge.style.display = 'none';
                }
            }

            showMessage(text) {
                const moveDetail = document.getElementById('moveDetail');
                const originalText = moveDetail.textContent;
                moveDetail.textContent = text;
                moveDetail.style.color = '#fbbf24';
                setTimeout(() => {
                    moveDetail.textContent = originalText;
                    moveDetail.style.color = '';
                }, 2000);
            }

            shakeElement(element) {
                element.style.animation = 'none';
                element.offsetHeight; // è§¦å‘é‡æ’
                element.style.animation = 'shake 0.4s';
                setTimeout(() => element.style.animation = '', 400);
            }

            findHole(row, col) {
                return this.holes.find(h => 
                    parseInt(h.dataset.row) === row && parseInt(h.dataset.col) === col
                );
            }

            onHoleClick(pos) {
                if (this.isMoving || !this.selectedPiece) return;
                
                const move = this.validMoves.find(m => m.row === pos.row && m.col === pos.col);
                if (!move) return;
                
                this.executeMove(move);
            }

            executeMove(move) {
                this.isMoving = true;
                const oldRow = parseInt(this.selectedPiece.dataset.row);
                const oldCol = parseInt(this.selectedPiece.dataset.col);
                const newRow = move.row;
                const newCol = move.col;
                const player = parseInt(this.selectedPiece.dataset.player);
                
                // æ˜¾ç¤ºç§»åŠ¨è·¯å¾„
                if (move.path && move.path.length > 1) {
                    this.showMovePath(move.path);
                }
                
                // å¦‚æœä¸æ˜¯è¿è·³çŠ¶æ€ï¼Œè®°å½•å†å²ï¼ˆè¿è·³åªåœ¨æœ€åè®°å½•ä¸€æ¬¡ï¼‰
                if (!this.isInJumpChain) {
                    this.moveHistory.push({
                        piece: this.selectedPiece,
                        from: {row: oldRow, col: oldCol},
                        to: {row: newRow, col: newCol},
                        player: player,
                        path: move.path,
                        isChainStart: true
                    });
                    this.originalPiece = this.selectedPiece;
                    this.jumpStartPosition = {row: oldRow, col: oldCol};
                } else {
                    // æ›´æ–°æœ€åä¸€æ¬¡ç§»åŠ¨çš„å†å²è®°å½•
                    const lastMove = this.moveHistory[this.moveHistory.length - 1];
                    lastMove.to = {row: newRow, col: newCol};
                    lastMove.path = move.path;
                }
                
                document.getElementById('undoBtn').disabled = false;
                
                // æ›´æ–°æ£‹ç›˜çŠ¶æ€
                this.boardState.delete(`${oldRow}-${oldCol}`);
                this.boardState.set(`${newRow}-${newCol}`, player);
                
                const newPos = this.positions[newRow][newCol];
                
                // ç§»åŠ¨åŠ¨ç”»
                this.selectedPiece.style.transition = 'all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1)';
                this.selectedPiece.style.left = (newPos.x - 13) + 'px';
                this.selectedPiece.style.top = (newPos.y - 13) + 'px';
                
                setTimeout(() => {
                    this.selectedPiece.dataset.row = newRow;
                    this.selectedPiece.dataset.col = newCol;
                    this.selectedPiece.style.transition = '';
                    
                    this.showLastMove(newPos);
                    
                    // åˆ¤æ–­æ˜¯å¦ç»§ç»­è¿è·³
                    if (move.isJump && move.canContinue) {
                        this.isInJumpChain = true;
                        this.jumpChainCount = move.jumpCount;
                        
                        // é‡æ–°è®¡ç®—å¯ç»§ç»­è·³è·ƒçš„ä½ç½®
                        this.validMoves = this.calculateJumpOnlyMoves({row: newRow, col: newCol});
                        
                        if (this.validMoves.length > 0) {
                            // ä¿æŒé€‰ä¸­çŠ¶æ€ï¼Œæ›´æ–°æç¤º
                            this.updateMoveInfo();
                            if (this.showMoveHint) {
                                this.highlightValidMoves();
                            }
                            this.isMoving = false;
                            
                            // è‡ªåŠ¨æç¤ºå¯ä»¥æŒ‰ç©ºæ ¼ç»“æŸ
                            if (this.jumpChainCount >= 3) {
                                this.showMessage(`ç²¾å½©ï¼å·²è¿è·³${this.jumpChainCount}æ¬¡ï¼ŒæŒ‰ç©ºæ ¼å¯éšæ—¶ç»“æŸ`);
                            }
                        } else {
                            // æ— æ³•ç»§ç»­è·³è·ƒï¼Œè‡ªåŠ¨ç»“æŸå›åˆ
                            this.endJumpChain();
                        }
                    } else {
                        // å•æ­¥ç§»åŠ¨ï¼Œç›´æ¥ç»“æŸå›åˆ
                        this.deselect();
                        if (this.checkWin(player)) {
                            this.showWin(player);
                        } else {
                            this.nextPlayer();
                        }
                        this.isMoving = false;
                    }
                }, 400);
            }

            endJumpChain() {
                if (!this.isInJumpChain) return;
                
                this.isInJumpChain = false;
                this.deselect();
                
                const player = this.currentPlayer;
                if (this.checkWin(player)) {
                    this.showWin(player);
                } else {
                    this.nextPlayer();
                }
                this.isMoving = false;
            }

            showMovePath(path) {
                document.querySelectorAll('.move-path').forEach(el => el.remove());
                
                const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
                svg.classList.add('move-path');
                svg.style.cssText = 'position:absolute;left:0;top:0;width:100%;height:100%;pointer-events:none;z-index:18;';
                
                let pathData = '';
                for (let i = 0; i < path.length; i++) {
                    const pos = this.positions[path[i].row][path[i].col];
                    if (i === 0) pathData = `M ${pos.x} ${pos.y}`;
                    else pathData += ` L ${pos.x} ${pos.y}`;
                }
                
                const pathEl = document.createElementNS("http://www.w3.org/2000/svg", "path");
                pathEl.setAttribute("d", pathData);
                pathEl.setAttribute("stroke", this.isInJumpChain ? "#fbbf24" : "#60a5fa");
                pathEl.setAttribute("stroke-width", "3");
                pathEl.setAttribute("fill", "none");
                pathEl.setAttribute("stroke-linecap", "round");
                pathEl.setAttribute("stroke-linejoin", "round");
                pathEl.setAttribute("stroke-dasharray", "8,4");
                pathEl.style.filter = `drop-shadow(0 0 8px ${this.isInJumpChain ? "#fbbf24" : "#60a5fa"})`;
                
                // è·¯å¾„åŠ¨ç”»
                const length = 1000;
                pathEl.style.strokeDasharray = length;
                pathEl.style.strokeDashoffset = length;
                pathEl.style.animation = 'draw-path 0.5s ease-out forwards';
                
                const style = document.createElement('style');
                style.textContent = '@keyframes draw-path { to { stroke-dashoffset: 0; } }';
                document.head.appendChild(style);
                
                svg.appendChild(pathEl);
                this.board.appendChild(svg);
                
                setTimeout(() => {
                    svg.remove();
                    style.remove();
                }, 2500);
            }

            showLastMove(pos) {
                const indicator = document.createElement('div');
                indicator.className = 'last-move';
                indicator.style.left = (pos.x - 16) + 'px';
                indicator.style.top = (pos.y - 16) + 'px';
                this.board.appendChild(indicator);
                setTimeout(() => indicator.remove(), 2000);
            }

            deselect() {
                if (this.selectedPiece) {
                    this.selectedPiece.classList.remove('selected');
                    this.selectedPiece = null;
                }
                this.validMoves = [];
                this.clearHighlights();
                
                if (!this.isInJumpChain) {
                    document.getElementById('moveDetail').textContent = 'é€‰æ‹©æ£‹å­æŸ¥çœ‹å¯ç§»åŠ¨ä½ç½®';
                    document.getElementById('statusBadge').style.display = 'none';
                }
            }

            nextPlayer() {
                const playOrder = this.getPlayOrder();
                const currentIndex = playOrder.indexOf(this.currentPlayer);
                this.currentPlayer = playOrder[(currentIndex + 1) % playOrder.length];
                this.jumpChainCount = 0;
                this.isInJumpChain = false;
                this.originalPiece = null;
                this.jumpStartPosition = null;
                this.updatePlayerDisplay();
            }

            updatePlayerDisplay() {
                const indicator = document.getElementById('playerIndicator');
                const text = document.getElementById('playerText');
                const display = document.getElementById('currentPlayer');
                
                indicator.style.background = this.colorCodes[this.currentPlayer];
                indicator.style.boxShadow = `0 0 15px ${this.colorCodes[this.currentPlayer]}`;
                text.textContent = `${this.playerColors[this.currentPlayer]}æ–¹å›åˆ`;
                display.style.borderColor = this.colorCodes[this.currentPlayer];
                display.style.boxShadow = `0 0 20px ${this.colorCodes[this.currentPlayer]}40`;
            }

            checkWin(player) {
                const targetPlayer = (player + 3) % 6;
                const allPositions = this.getAllCornerPositions();
                const targetPositions = allPositions[targetPlayer];
                
                let count = 0;
                for (let pos of targetPositions) {
                    if (this.boardState.get(`${pos.row}-${pos.col}`) === player) count++;
                }
                
                return count >= 10;
            }

            showWin(player) {
                const modal = document.getElementById('winMessage');
                const text = document.getElementById('winnerText');
                text.innerHTML = `<div style="font-size: 1.4em; margin-bottom: 10px;"><span style="color: ${this.colorCodes[player]}; text-shadow: 0 0 20px currentColor;">${this.playerColors[player]}æ–¹</span></div><div style="color: #94a3b8; font-size: 0.9em;">ç‡å…ˆå é¢†å¯¹è§’è¥åœ°ï¼</div>`;
                modal.style.display = 'block';
            }

            undo() {
                if (this.isMoving || this.moveHistory.length === 0) return;
                
                // å¦‚æœæ­£åœ¨è¿è·³ï¼Œå…ˆç»“æŸè¿è·³çŠ¶æ€
                if (this.isInJumpChain) {
                    this.isInJumpChain = false;
                    this.jumpChainCount = 0;
                }
                
                const lastMove = this.moveHistory.pop();
                const piece = lastMove.piece;
                
                this.boardState.delete(`${lastMove.to.row}-${lastMove.to.col}`);
                this.boardState.set(`${lastMove.from.row}-${lastMove.from.col}`, lastMove.player);
                
                const oldPos = this.positions[lastMove.from.row][lastMove.from.col];
                
                piece.style.transition = 'all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1)';
                piece.style.left = (oldPos.x - 13) + 'px';
                piece.style.top = (oldPos.y - 13) + 'px';
                
                setTimeout(() => {
                    piece.dataset.row = lastMove.from.row;
                    piece.dataset.col = lastMove.from.col;
                    piece.style.transition = '';
                    
                    this.currentPlayer = lastMove.player;
                    this.updatePlayerDisplay();
                    this.deselect();
                    
                    if (this.moveHistory.length === 0) {
                        document.getElementById('undoBtn').disabled = true;
                    }
                }, 500);
            }

            reset() {
                this.moveHistory = [];
                this.isMoving = false;
                this.isInJumpChain = false;
                this.jumpChainCount = 0;
                this.originalPiece = null;
                this.jumpStartPosition = null;
                
                document.getElementById('undoBtn').disabled = true;
                document.getElementById('winMessage').style.display = 'none';
                document.getElementById('moveDetail').textContent = 'é€‰æ‹©æ£‹å­å¼€å§‹æ¸¸æˆ';
                document.getElementById('statusBadge').style.display = 'none';
                
                const activePlayers = this.getActivePlayers();
                this.currentPlayer = activePlayers[0];
                
                this.deselect();
                this.setupPieces();
                this.updatePlayerDisplay();
            }
        }

        const game = new ChineseCheckers();
        
        // æ·»åŠ æ‘‡æ™ƒåŠ¨ç”»æ ·å¼
        const shakeStyle = document.createElement('style');
        shakeStyle.textContent = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                20%, 60% { transform: translateX(-5px); }
                40%, 80% { transform: translateX(5px); }
            }
        `;
        document.head.appendChild(shakeStyle);
    </script>
</body>
</html>

